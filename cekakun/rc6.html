<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Hive RC â€“ PeakD Final FIX</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  font-family:system-ui,Arial;
  background:#0f172a;
  color:#e5e7eb;
  padding:20px
}
input,button{
  padding:10px;
  font-size:16px
}
button{cursor:pointer}
.card{
  background:#111827;
  border-radius:12px;
  padding:16px;
  margin-top:16px
}
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px
}
.item{
  background:#1f2933;
  padding:10px;
  border-radius:8px
}
.label{
  font-size:12px;
  opacity:.7
}
.value{
  font-size:16px;
  font-weight:bold
}
.bar{
  background:#020617;
  border-radius:10px;
  overflow:hidden;
  height:16px;
  margin-top:6px
}
.fill{
  height:100%;
  background:linear-gradient(90deg,#22c55e,#4ade80)
}
small{opacity:.7}
</style>
</head>
<body>

<h1>Hive Account (PeakD Accurate)</h1>

<input id="user" placeholder="username hive">
<button onclick="cek()">Cek</button>

<div id="ui"></div>

<script>
let rcInterval=null;

function num(v){
  return parseFloat(v.split(" ")[0]);
}

async function rpc(method, params){
  const res = await fetch("https://api.hive.blog",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      jsonrpc:"2.0",
      method: method,
      params: params,
      id:1
    })
  });
  const json = await res.json();
  if(json.error) throw json.error;
  return json.result;
}

async function cek(){
  if(rcInterval) clearInterval(rcInterval);

  const username = document.getElementById("user").value.trim().toLowerCase();
  if(!username) return;

  try{
    const [acc, global, rcData] = await Promise.all([
      rpc("condenser_api.get_accounts", [[username]]),
      rpc("condenser_api.get_dynamic_global_properties", []),
      rpc("rc_api.find_rc_accounts", [{ accounts:[username] }])
    ]);

    if(!acc || !acc[0]){
      document.getElementById("ui").innerHTML="Akun tidak ditemukan";
      return;
    }

    const data = acc[0];
    const rcAcc = rcData.rc_accounts[0];

    const vests = num(data.vesting_shares);
    const hp =
      vests *
      num(global.total_vesting_fund_hive) /
      num(global.total_vesting_shares);

    const maxMana = rcAcc.max_rc;
    const baseMana = rcAcc.rc_manabar.current_mana;
    const last = rcAcc.rc_manabar.last_update_time;
    const regenSeconds = 432000;

    function render(){
      const now = Math.floor(Date.now()/1000);
      const elapsed = now - last;
      const regen = (maxMana / regenSeconds) * elapsed;
      const current = Math.min(maxMana, baseMana + regen);
      const percent = (current / maxMana) * 100;

      document.getElementById("ui").innerHTML = `
        <div class="card">
          <h2>@${data.name}</h2>
          <small>Dibuat: ${new Date(data.created).toLocaleString()}</small>
        </div>

        <div class="card">
          <div class="label">Resource Credits</div>
          <div class="bar">
            <div class="fill" style="width:${percent.toFixed(2)}%"></div>
          </div>
          <small>
            Available: ${current.toLocaleString()} RC<br>
            Total: ${maxMana.toLocaleString()} RC<br>
            UI RC: ${(current/1e6).toFixed(0)} / ${(maxMana/1e6).toFixed(0)}
            (${percent.toFixed(2)}%)
          </small>
        </div>

        <div class="card grid">
          <div class="item">
            <div class="label">Hive Power</div>
            <div class="value">${hp.toFixed(3)} HP</div>
          </div>
          <div class="item">
            <div class="label">VESTS</div>
            <div class="value">${data.vesting_shares}</div>
          </div>
          <div class="item">
            <div class="label">HIVE</div>
            <div class="value">${data.balance}</div>
          </div>
          <div class="item">
            <div class="label">HBD</div>
            <div class="value">${data.hbd_balance}</div>
          </div>
        </div>
      `;
    }

    render();
    rcInterval = setInterval(render,1000);

  }catch(e){
    console.error(e);
    document.getElementById("ui").innerHTML =
      "Gagal mengambil data Hive (RC API)";
  }
}
</script>

</body>
</html>